<script th:fragment="dark-mode-script">
// ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿æ©Ÿèƒ½
(function() {
    'use strict';
    
    const THEME_KEY = 'household-management-theme';
    const LIGHT_THEME = 'light';
    const DARK_THEME = 'dark';
    const LIGHT_ICON = 'ğŸŒ';
    const DARK_ICON = 'ğŸŒ™';
    
    // ç¾åœ¨ã®ãƒ†ãƒ¼ãƒã‚’å–å¾—
    function getCurrentTheme() {
        return localStorage.getItem(THEME_KEY) || LIGHT_THEME;
    }
    
    // ãƒ†ãƒ¼ãƒã‚’è¨­å®š
    function setTheme(theme) {
        document.documentElement.setAttribute('data-bs-theme', theme);
        localStorage.setItem(THEME_KEY, theme);
        updateIcon(theme);
    }
    
    // ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°
    function updateIcon(theme) {
        const icon = document.getElementById('darkModeIcon');
        if (icon) {
            icon.textContent = theme === DARK_THEME ? LIGHT_ICON : DARK_ICON;
        }
    }
    
    // ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆ
    function toggleTheme() {
        const currentTheme = getCurrentTheme();
        const newTheme = currentTheme === DARK_THEME ? LIGHT_THEME : DARK_THEME;
        setTheme(newTheme);
    }
    
    // åˆæœŸåŒ–å‡¦ç†
    function initializeDarkMode() {
        const currentTheme = getCurrentTheme();
        setTheme(currentTheme);
        
        // ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        const toggleButton = document.getElementById('darkModeToggle');
        if (toggleButton) {
            toggleButton.addEventListener('click', toggleTheme);
        }
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeDarkMode);
    } else {
        initializeDarkMode();
    }
})();
</script>
